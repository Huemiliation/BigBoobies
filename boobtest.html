<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Our Memories</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        script: ['"Great Vibes"', 'cursive'],
                        sans: ['"Montserrat"', 'sans-serif'],
                    },
                    colors: {
                        glass: "rgba(255, 255, 255, 0.05)",
                    }
                }
            }
        }
    </script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://www.youtube.com/iframe_api"></script>

    <style>
        /* Custom Utilities */
        body { overflow-x: hidden; transition: background 1.5s ease; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .liquid-glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        
        /* Floating Hearts Animation */
        .heart-particle { position: fixed; pointer-events: none; z-index: 1; opacity: 0; }
        @keyframes floatUp {
            0% { transform: translateY(0) rotate(45deg) scale(0); opacity: 0; }
            20% { opacity: 0.6; }
            100% { transform: translateY(-100vh) rotate(90deg) scale(1); opacity: 0; }
        }
    </style>
</head>
<body class="bg-black text-white selection:bg-pink-500 selection:text-white">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { motion, AnimatePresence, useScroll, useTransform } = window.Motion;

        // --- Configuration Data ---
        const CHAPTERS = [
            {
                id: 1,
                title: "Chapter 1",
                subtitle: "The Beginning",
                theme: { from: "#2e0212", to: "#000000", accent: "#ff007f" }, // Joji Red/Dark
                song: { title: "Test Drive", id: "PEKSrqmKgyo" },
                albums: [
                    { title: "First Glances", photos: [101, 102, 103] },
                    { title: "Late Night Talks", photos: [104, 105, 106] },
                    { title: "Coffee Dates", photos: [107, 108, 109] },
                    { title: "The Park", photos: [110, 111, 112] },
                    { title: "Holding Hands", photos: [113, 114, 115] }
                ]
            },
            {
                id: 2,
                title: "Chapter 2",
                subtitle: "Growing Closer",
                theme: { from: "#0f172a", to: "#000000", accent: "#fbbf24" }, // M83 Blue/Gold
                song: { title: "Your Dreams", id: "lAwYodrBr2Q" }, // Wait - M83
                albums: [
                    { title: "Road Trips", photos: [201, 202, 203] },
                    { title: "Stargazing", photos: [204, 205, 206] },
                    { title: "Beach Days", photos: [207, 208, 209] },
                    { title: "Festivals", photos: [210, 211, 212] },
                    { title: "Sunsets", photos: [213, 214, 215] }
                ]
            },
            {
                id: 3,
                title: "Chapter 3",
                subtitle: "Forever",
                theme: { from: "#1c1917", to: "#000000", accent: "#e5e7eb" }, // Radiohead Monochrome
                song: { title: "I will see you in the next life", id: "n5h0qHwNrHk" }, // Motion Picture Soundtrack
                albums: [
                    { title: "Moving In", photos: [301, 302, 303] },
                    { title: "Anniversaries", photos: [304, 305, 306] },
                    { title: "Quiet Mornings", photos: [307, 308, 309] },
                    { title: "Adventures", photos: [310, 311, 312] },
                    { title: "The Future", photos: [313, 314, 315] }
                ]
            }
        ];

        // --- Components ---

        // 1. Music Player Button
        const MusicPlayer = ({ song, accent, activeVideoId, onPlay }) => {
            const isPlaying = activeVideoId === song.id;
            
            return (
                <div className="flex justify-center my-6">
                    <button 
                        onClick={() => onPlay(song.id)}
                        className="relative group px-8 py-3 rounded-full flex items-center gap-3 transition-all duration-500 overflow-hidden liquid-glass"
                        style={{ borderColor: isPlaying ? accent : 'rgba(255,255,255,0.2)' }}
                    >
                        {/* Glowing Background */}
                        <div 
                            className={`absolute inset-0 opacity-20 transition-all duration-500`}
                            style={{ backgroundColor: accent, opacity: isPlaying ? 0.4 : 0 }}
                        ></div>
                        
                        {/* Breathing Animation for "Playing" State */}
                        {isPlaying && (
                            <div className="absolute inset-0 animate-pulse" style={{ boxShadow: `0 0 20px ${accent}` }}></div>
                        )}

                        <span className="relative z-10 text-xl">{isPlaying ? '⏸' : '▶'}</span>
                        <span className="relative z-10 font-sans font-bold uppercase tracking-widest text-xs sm:text-sm">
                            {song.title}
                        </span>
                    </button>
                </div>
            );
        };

        // 2. Typewriter Effect
        const Typewriter = ({ text, speed = 30 }) => {
            const [displayedText, setDisplayedText] = useState("");
            
            useEffect(() => {
                setDisplayedText("");
                let i = 0;
                const timer = setInterval(() => {
                    if (i < text.length) {
                        setDisplayedText((prev) => prev + text.charAt(i));
                        i++;
                    } else {
                        clearInterval(timer);
                    }
                }, speed);
                return () => clearInterval(timer);
            }, [text, speed]);

            return <p className="text-gray-200 font-sans leading-relaxed">{displayedText}</p>;
        };

        // 3. Heart Navigation Buttons
        const HeartNav = ({ direction, onClick, accent }) => {
            // direction -1 = left, 1 = right
            // Left heart points left (-90deg), Right heart points right (90deg)
            const rotation = direction === -1 ? -90 : 90;
            
            return (
                <button 
                    onClick={(e) => { e.stopPropagation(); onClick(); }}
                    className="p-4 hover:scale-110 transition-transform active:scale-95 opacity-70 hover:opacity-100"
                    style={{ color: accent }}
                >
                    <svg 
                        width="40" height="40" viewBox="0 0 24 24" fill="currentColor" 
                        style={{ transform: `rotate(${rotation}deg)` }}
                    >
                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                    </svg>
                </button>
            );
        };

        // 4. Infinite Carousel
        const Carousel = ({ photos, onOpen, accent }) => {
            // Duplicate photos for infinite loop
            const displayPhotos = [...photos, ...photos, ...photos]; 
            
            return (
                <div className="w-full overflow-hidden relative py-8 group">
                    <div className="absolute left-0 top-0 bottom-0 w-8 z-10 bg-gradient-to-r from-black/50 to-transparent"></div>
                    <div className="absolute right-0 top-0 bottom-0 w-8 z-10 bg-gradient-to-l from-black/50 to-transparent"></div>
                    
                    <div className="flex w-max gap-6 animate-scroll hover:pause-scroll">
                        {displayPhotos.map((photoId, idx) => (
                            <motion.div
                                key={`${photoId}-${idx}`}
                                whileHover={{ y: -10, scale: 1.05 }}
                                className="relative w-[140px] h-[200px] sm:w-[180px] sm:h-[260px] flex-shrink-0 rounded-2xl overflow-hidden cursor-pointer border border-white/10"
                                onClick={() => onOpen(photoId)}
                            >
                                <img 
                                    src={`https://picsum.photos/seed/${photoId}/600/800`} 
                                    alt="memory" 
                                    className="w-full h-full object-cover"
                                />
                                <div className="absolute inset-0 bg-black/20 hover:bg-transparent transition-colors"></div>
                            </motion.div>
                        ))}
                    </div>
                    
                    {/* CSS Animation defined in style block below */}
                </div>
            );
        };

        // 5. Lightbox Modal
        const Lightbox = ({ isOpen, seed, onClose, accent, onNext, onPrev }) => {
            if (!isOpen) return null;

            return (
                <motion.div 
                    initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}
                    className="fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-xl p-4"
                    onClick={onClose}
                >
                    {/* Controls */}
                    <button onClick={onClose} className="absolute top-6 right-6 text-white/50 hover:text-white text-4xl">&times;</button>
                    
                    <div className="absolute left-4 top-1/2 -translate-y-1/2 z-50">
                        <HeartNav direction={-1} onClick={onPrev} accent={accent} />
                    </div>
                    <div className="absolute right-4 top-1/2 -translate-y-1/2 z-50">
                        <HeartNav direction={1} onClick={onNext} accent={accent} />
                    </div>

                    <motion.div 
                        initial={{ y: 50, scale: 0.9 }} 
                        animate={{ y: 0, scale: 1 }} 
                        className="w-full max-w-lg flex flex-col items-center gap-6"
                        onClick={e => e.stopPropagation()}
                    >
                        <motion.div 
                            className="relative w-full aspect-[3/4] rounded-2xl overflow-hidden shadow-2xl border border-white/10"
                            style={{ boxShadow: `0 0 40px ${accent}40` }}
                        >
                            <img 
                                src={`https://picsum.photos/seed/${seed}/600/800`} 
                                className="w-full h-full object-cover" 
                            />
                        </motion.div>

                        <div className="w-full liquid-glass rounded-xl p-6 min-h-[120px] max-h-[200px] overflow-y-auto">
                            <Typewriter 
                                text="I remember this moment vividly. The way the light caught your eyes, the sound of your laughter echoing around us. It's a memory I want to keep on replay forever. You make every simple moment feel like magic." 
                                speed={15} // Faster speed as requested
                            />
                        </div>
                    </motion.div>
                </motion.div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [activeChapter, setActiveChapter] = useState(0);
            const [lightboxOpen, setLightboxOpen] = useState(false);
            const [currentPhoto, setCurrentPhoto] = useState(null);
            const [activeVideoId, setActiveVideoId] = useState(null);
            const playerRef = useRef(null);

            // Setup YouTube API
            useEffect(() => {
                window.onYouTubeIframeAPIReady = () => {
                    playerRef.current = new YT.Player('player-frame', {
                        height: '0', width: '0',
                        playerVars: { 'autoplay': 0, 'controls': 0 }
                    });
                };
            }, []);

            // Scroll Listener for Theming
            useEffect(() => {
                const handleScroll = () => {
                    const sections = document.querySelectorAll('.chapter-section');
                    sections.forEach((sec, index) => {
                        const rect = sec.getBoundingClientRect();
                        // If section is in middle of screen
                        if (rect.top < window.innerHeight / 2 && rect.bottom > window.innerHeight / 2) {
                            setActiveChapter(index);
                        }
                    });
                };
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            // Music Control
            const toggleMusic = (videoId) => {
                if (activeVideoId === videoId) {
                    playerRef.current.pauseVideo();
                    setActiveVideoId(null);
                } else {
                    setActiveVideoId(videoId);
                    playerRef.current.loadVideoById(videoId);
                    playerRef.current.playVideo();
                }
            };

            const currentTheme = CHAPTERS[activeChapter].theme;

            // Lightbox Nav
            const handleNext = () => setCurrentPhoto(prev => prev + 1);
            const handlePrev = () => setCurrentPhoto(prev => prev - 1);

            return (
                <div 
                    className="min-h-screen transition-colors duration-[1500ms]"
                    style={{ 
                        background: `radial-gradient(circle at top center, ${currentTheme.from} 0%, ${currentTheme.to} 100%)`
                    }}
                >
                    {/* Background Stars */}
                    <div className="fixed inset-0 pointer-events-none z-0">
                        <div id="stars"></div>
                    </div>

                    {/* Hidden YT Player */}
                    <div id="player-frame" className="fixed top-0 left-0 w-0 h-0 overflow-hidden"></div>

                    {/* Main Content */}
                    <div className="relative z-10 max-w-3xl mx-auto px-4 pb-32">
                        
                        <header className="pt-24 pb-12 text-center animate-fade-in-up">
                            <h1 className="font-script text-7xl sm:text-8xl md:text-9xl mb-4" style={{ textShadow: `0 0 30px ${currentTheme.accent}` }}>
                                Our Memories
                            </h1>
                            <p className="font-sans tracking-[0.3em] uppercase text-sm text-gray-400">A Digital Collection</p>
                        </header>

                        {CHAPTERS.map((chapter, index) => (
                            <section 
                                key={chapter.id} 
                                className="chapter-section py-20 min-h-[80vh] flex flex-col justify-center"
                            >
                                <div className="text-center mb-12">
                                    <h2 className="font-script text-6xl text-white/90 mb-2">{chapter.title}</h2>
                                    <h3 className="font-sans text-xl tracking-widest uppercase text-white/60 mb-8">{chapter.subtitle}</h3>
                                    
                                    <MusicPlayer 
                                        song={chapter.song} 
                                        accent={chapter.theme.accent} 
                                        activeVideoId={activeVideoId}
                                        onPlay={toggleMusic}
                                    />
                                </div>

                                <div className="space-y-16">
                                    {chapter.albums.map((album, aIdx) => (
                                        <div key={aIdx} className="liquid-glass rounded-3xl p-6 sm:p-8">
                                            <h4 className="font-sans font-bold text-lg mb-4 ml-2 border-l-4 pl-4" style={{ borderColor: currentTheme.accent }}>
                                                {album.title}
                                            </h4>
                                            
                                            <Carousel 
                                                photos={album.photos} 
                                                onOpen={(id) => { setLightboxOpen(true); setCurrentPhoto(id); }}
                                                accent={currentTheme.accent}
                                            />

                                            <p className="mt-4 text-sm text-gray-400 font-light italic ml-2">
                                                Scroll to see more moments...
                                            </p>
                                        </div>
                                    ))}
                                </div>
                            </section>
                        ))}
                    </div>

                    {/* Lightbox */}
                    <AnimatePresence>
                        {lightboxOpen && (
                            <Lightbox 
                                isOpen={lightboxOpen} 
                                seed={currentPhoto}
                                onClose={() => setLightboxOpen(false)}
                                accent={currentTheme.accent}
                                onNext={handleNext}
                                onPrev={handlePrev}
                            />
                        )}
                    </AnimatePresence>
                </div>
            );
        };

        // --- Global Animations & Init ---
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes scroll {
                0% { transform: translateX(0); }
                100% { transform: translateX(-33.33%); }
            }
            .animate-scroll {
                animation: scroll 60s linear infinite; /* Slower speed */
            }
            .group:hover .animate-scroll {
                animation-play-state: paused;
            }
            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-fade-in-up {
                animation: fadeInUp 1s ease-out forwards;
            }
            #stars {
                width: 2px; height: 2px; background: transparent;
                box-shadow: ${Array(100).fill(0).map(() => `${Math.random()*100}vw ${Math.random()*2000}px #FFF`).join(',')};
                animation: animStar 100s linear infinite;
            }
            @keyframes animStar { from { transform: translateY(0); } to { transform: translateY(-2000px); } }
        `;
        document.head.appendChild(styleSheet);

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // --- Heart Particles (Vanilla JS for performance) ---
        setInterval(() => {
            if(document.hidden) return;
            const h = document.createElement('div');
            h.classList.add('heart-particle');
            const size = Math.random() * 15 + 10;
            h.style.width = size+'px'; h.style.height = size+'px';
            h.style.left = Math.random() * 100 + 'vw';
            h.style.bottom = '-50px';
            h.style.background = ['#ff007f', '#fbbf24', '#e5e7eb'][Math.floor(Math.random()*3)];
            
            // CSS Heart Shape
            h.style.position = 'fixed';
            h.style.transform = 'rotate(45deg)';
            h.innerHTML = '<div style="position:absolute; width:100%; height:100%; background:inherit; border-radius:50%; top:-50%; left:0;"></div><div style="position:absolute; width:100%; height:100%; background:inherit; border-radius:50%; top:0; left:-50%;"></div>';
            
            h.style.animation = 'floatUp ' + (6 + Math.random()*4) + 's linear forwards';
            document.body.appendChild(h);
            setTimeout(() => h.remove(), 10000);
        }, 1500);

    </script>
</body>
</html>
